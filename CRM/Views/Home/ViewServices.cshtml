@model List<ServiceModel>

<head>
    <!-- Existing head content -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        th {
            background-color: rgb(27, 40, 80) !important;
            color: white !important;
        }
    </style>
</head>
<div class="page-wrapper">
    <div class="content">
        <div class="row">
            <main id="main" class=" card">
                <div class="container mt-4" style="border: 2px solid;border-radius: 18px;color: #1b2850;">
                    <h3 style="width: 222px;text-align: center;border-radius: 14px;color: #f2f0f4;background-color: #1b2850;margin-top: -18px;margin-left: 16px;">View Services</h3>
              <br />
                <div class="table-responsive">
                <table id="servicesTable" class="table table-striped table-bordered">
                    <thead>
                                <tr style="text-align: center;">
                            <th>Service id</th>
                            <th>Service Name</th>
                          @*   <th>Description</th> *@
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Price Per Unit</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var service in Model)
                        {
                                    <tr style="text-align: center;">
                                <td>@service.Id</td>
                                <td>@service.ServiceName</td>
                               @*  <td>@service.Description</td> *@
                                <td>@service.Quantity</td>
                                <td>@service.Price</td>
                                <td>@service.Priceperunit</td>
                                    <td>
                                        <button class="btn btn-danger delete-btn" data-serviceid="@service.Id">
                                            <i class="fas fa-trash-alt"></i> 
                                        </button>
                                        <button class="btn btn-primary edit-btn" data-serviceid="@service.Id">
                                            <i class="fas fa-edit"></i> 
                                        </button>
                                    </td>
                            </tr>
                        }
                    </tbody>
                </table>
                </div>
                <!-- Edit Modal -->
                <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editModalLabel">Edit Service</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <!-- Editable input fields for service details -->
                                <form id="editForm">
                                    <div class="form-group">
                                        <label for="editServiceId">Service Id:</label>
                                        <!-- Readonly input field for Id -->
                                        <input type="text" class="form-control" id="editServiceId" readonly />
                                    </div>
                                    <div class="form-group">
                                        <label for="editServiceName">Service Name:</label>
                                        <input type="text" class="form-control" id="editServiceName" required />
                                    </div>
                                    <div class="form-group">
                                        <label for="editDescription">Description:</label>
                                        <textarea class="form-control" id="editDescription" required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="editQuantity">Quantity:</label>
                                        <input type="number" class="form-control" id="editQuantity" required />
                                    </div>
                                    <div class="form-group">
                                        <label for="editPrice">Price:</label>
                                        <input type="number" class="form-control" id="editPrice" required />
                                    </div>
                                    <div class="form-group">
                                        <label for="editPriceperunit">Price Per Unit:</label>
                                        <input type="number" class="form-control" id="editPriceperunit" required />
                                    </div>
                                    <!-- Add other editable fields as needed -->
                                    <button type="button" class="btn btn-primary" onclick="saveEditedService()">Save</button>

                                </form>
                                <script>
                                    // Declare saveEditedService function globally
                                    function saveEditedService() {
                                        // Get edited service details from the modal
                                        var editedService = {
                                            Id: $('#editServiceId').val(),
                                            ServiceName: $('#editServiceName').val(),
                                            Description: $('#editDescription').val(),
                                            Quantity: $('#editQuantity').val(),
                                            Price: $('#editPrice').val(),
                                            Priceperunit: $('#editPriceperunit').val(),
                                            // Add other edited fields as needed
                                        };

                                        // Perform update action
                                        $.ajax({
                                            url: '/Home/UpdateService',
                                            type: 'POST',
                                            data: editedService,
                                            success: function (data) {
                                                if (data.success) {
                                                    // Reload the page or update the DataTable
                                                    location.reload();
                                                } else {
                                                    alert('Error updating service.');
                                                }
                                            },
                                            error: function () {
                                                alert('Error updating service.');
                                            }
                                        });
                                    }

                                    // Edit button click event
                                    $('#servicesTable tbody').on('click', '.edit-btn', function () {
                                        var serviceId = $(this).data('serviceid');

                                        // Fetch service details from the server
                                        $.ajax({
                                            url: '/Home/GetServiceDetails',
                                            type: 'GET',
                                            data: { id: serviceId },
                                            success: function (data) {
                                                if (data) {
                                                    // Populate the edit modal with existing service details
                                                    $('#editServiceId').val(data.id);
                                                    $('#editServiceName').val(data.serviceName);
                                                    $('#editDescription').val(data.description);
                                                    $('#editQuantity').val(data.quantity);
                                                    $('#editPrice').val(data.price);
                                                    $('#editPriceperunit').val(data.priceperunit);
                                                    // Populate other fields as needed

                                                    // Show the edit modal
                                                    $('#editModal').modal('show');
                                                } else {
                                                    alert('Error loading service details.');
                                                }
                                            },
                                            error: function () {
                                                alert('Error loading service details.');
                                            }
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <script>
                    // Your existing script here
                    // ...

                    $(document).ready(function () {
                        console.log("Document ready!");

                        // Initialize DataTable
                        table = $('#servicesTable').DataTable({
                            responsive: true
                        });

                        // Edit button click event
                        $('#servicesTable tbody').on('click', '.edit-btn', function () {
                            var serviceId = $(this).data('serviceid');
                            var serviceDetails = getServiceDetails(serviceId);

                            // Populate the edit modal with existing service details
                            $('#editServiceId').val(serviceDetails.Id);
                            $('#editServiceName').val(serviceDetails.ServiceName);
                            $('#editDescription').val(serviceDetails.Description);
                            // Populate other fields as needed

                            // Show the edit modal
                            $('#editModal').modal('show');
                        });

                        // Delete button click event
                        $('#servicesTable tbody').on('click', '.delete-btn', function () {
                            var serviceId = $(this).data('serviceid');

                            // Show confirmation alert
                            if (confirm('Are you sure you want to delete this service?')) {
                                // Perform delete action
                                deleteService(serviceId);
                            }
                        });

                        function getServiceDetails(serviceId) {
                            var service;
                            $.ajax({
                                url: '/Home/GetServiceDetails',
                                type: 'GET',
                                data: { id: serviceId },
                                async: false,
                                success: function (data) {
                                    console.log("Received service details:", data);
                                    service = data;
                                },
                                error: function () {
                                    alert('Error loading service details.');
                                }
                            });

                            return service;
                        }

                        function deleteService(serviceId) {
                            $.ajax({
                                url: '/Home/DeleteService',
                                type: 'POST',
                                data: { id: serviceId },
                                success: function (data) {
                                    if (data.success) {
                                        // Reload the page or update the DataTable
                                        location.reload();
                                    } else {
                                        alert('Error deleting service.');
                                    }
                                },
                                error: function () {
                                    alert('Error deleting service.');
                                }
                            });
                        }
                    });
                </script>

            </main>
            
        </div>
    </div>
</div>

